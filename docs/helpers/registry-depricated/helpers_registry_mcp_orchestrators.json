{
  "metadata": {
    "version": "1.0.0",
    "last_updated": "2025-11-29",
    "description": "MCP Database helpers - Generic Orchestrator Tools (Layer 2) for directive discovery, helper lookup, system context, and relationship queries",
    "database": "aifp_core.db",
    "target_database": "aifp_core",
    "total_helpers": 4,
    "schema_version": "1.0",
    "notes": "Layer 2 generic orchestrators - high-level interfaces that compose multiple Layer 3 helpers. All tools are MCP-exposed (is_tool=true)."
  },
  "helper_schema": {
    "description": "Schema definition for helper entries",
    "fields": {
      "name": "Function name",
      "file_path": "Path to implementation file",
      "database": "Which database this helper operates on",
      "target_database": "CHECK constraint value for aifp_core.db",
      "purpose": "Detailed description of what this helper does",
      "parameters": "Array of parameter objects with name and type",
      "return_statements": "Array of AI behavioral guidance - what to check/do next after calling this helper",
      "error_handling": "How errors are handled",
      "used_by_directives": "Array of directive names that use this helper",
      "is_tool": "Boolean - exposed via MCP as tool",
      "is_sub_helper": "Boolean - internal utility helper not directly called by AI/directives",
      "calls_helpers": "Array of helper names this function calls"
    }
  },
  "database": "aifp_core.db",
  "file_location": "src/aifp/helpers/mcp/orchestrators/",
  "helpers": [
    {
      "name": "find_directives",
      "file_path": "src/aifp/helpers/mcp/orchestrators/directive_discovery.py",
      "database": "aifp_core.db",
      "target_database": "aifp_core",
      "purpose": "Intelligent directive discovery and matching. Single entry point for all directive lookup operations - by intent, keyword, category, or complex criteria. Uses semantic similarity for intent matching with confidence scores.",
      "parameters": [
        {"name": "query", "type": "str", "required": false, "default": null, "description": "Natural language query or keyword (e.g., 'I want to create a task', 'resume work', 'project_task_create')"},
        {"name": "filters", "type": "dict", "required": false, "default": {}, "description": "Structured filters: type (fp/project/user/git), category, level (1-4), priority, confidence_threshold"},
        {"name": "match_mode", "type": "str", "required": false, "default": "intent", "values": ["intent", "keyword", "category", "exact", "fuzzy"], "description": "How to interpret query"},
        {"name": "include_related", "type": "bool", "required": false, "default": false, "description": "Include related directives (depends_on, triggers, escalates_to)"},
        {"name": "limit", "type": "int", "required": false, "default": 10, "description": "Maximum number of results"}
      ],
      "return_statements": [
        "Returns dict with query, match_mode, matches array (directive + confidence + match_reasons + related_directives)",
        "Intent mode uses semantic similarity and confidence scores",
        "Each match includes confidence (0-1), match_reasons array, and optional related_directives",
        "Top match suggestion provided when confidence high",
        "Empty matches list if no results",
        "This is the primary entry point for directive discovery - replaces multiple separate lookups"
      ],
      "error_handling": "Returns empty matches list if no results. Logs failed queries. Suggests alternative search terms if query fails.",
      "used_by_directives": ["aifp_run"],
      "is_tool": true,
      "is_sub_helper": false,
      "calls_helpers": ["find_directive_by_intent", "search_directives", "get_directive", "get_directive_interactions"]
    },
    {
      "name": "find_helpers",
      "file_path": "src/aifp/helpers/mcp/orchestrators/helper_discovery.py",
      "database": "aifp_core.db",
      "target_database": "aifp_core",
      "purpose": "Intelligent helper function discovery. Find helpers by purpose, database, category, or usage pattern. Supports natural language queries, semantic matching, and grouping by database/category/file/is_tool.",
      "parameters": [
        {"name": "query", "type": "str", "required": false, "default": null, "description": "Natural language query or keyword (e.g., 'get task with flows and files', 'link task to flows')"},
        {"name": "filters", "type": "dict", "required": false, "default": {}, "description": "Structured filters: database (project/mcp/preferences/user_directives), is_tool (bool), used_by (directive name), category, file_path"},
        {"name": "include_examples", "type": "bool", "required": false, "default": false, "description": "Include code examples and usage patterns"},
        {"name": "group_by", "type": "str", "required": false, "default": null, "values": ["database", "category", "file", "is_tool"], "description": "Group results by field"},
        {"name": "limit", "type": "int", "required": false, "default": 20, "description": "Maximum results per group or total"}
      ],
      "return_statements": [
        "Returns dict with query, matches array (helper + relevance score + match_reasons + optional example)",
        "Semantic matching on purpose field for natural language queries",
        "Grouped response if group_by specified (groups dict with count per group)",
        "Each match includes relevance (0-1), match_reasons, optional usage examples",
        "Suggestion provided when clear best match exists",
        "Use for helper discovery, code completion, documentation generation"
      ],
      "error_handling": "Returns empty matches if no results. Suggests alternative search terms. Logs search queries for improvement.",
      "used_by_directives": [],
      "is_tool": true,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "get_system_context",
      "file_path": "src/aifp/helpers/mcp/orchestrators/system_context.py",
      "database": "aifp_core.db",
      "target_database": "aifp_core",
      "purpose": "Get complete AIFP system state and configuration. Single call for session initialization, debugging, and status reporting. Returns database health, directive counts, helper counts, active project, preferences, and system health checks.",
      "parameters": [
        {"name": "include_directives", "type": "bool", "required": false, "default": true, "description": "Include directive counts and categories"},
        {"name": "include_helpers", "type": "bool", "required": false, "default": true, "description": "Include helper counts and categories"},
        {"name": "include_preferences", "type": "bool", "required": false, "default": true, "description": "Include user preferences summary"},
        {"name": "include_project", "type": "bool", "required": false, "default": true, "description": "Include active project info"},
        {"name": "summary_only", "type": "bool", "required": false, "default": false, "description": "Return counts only (fast) vs full details (comprehensive)"}
      ],
      "return_statements": [
        "Returns comprehensive dict with aifp_version, databases (paths, sizes, health), directives (counts by type/level/category), helpers (counts by database, tools_exposed), active_project (name, status, progress, current_work), user_preferences (key settings), system_health (all checks)",
        "Summary mode returns just counts and health status (<50ms)",
        "Full context includes detailed breakdowns (<200ms)",
        "Returns partial data with health warnings if some databases inaccessible",
        "Never fails completely - graceful degradation",
        "Use for session initialization, aifp_status, diagnostics, health monitoring"
      ],
      "error_handling": "Returns partial data if some databases inaccessible. Flags unhealthy databases in response. Never fails completely - graceful degradation.",
      "used_by_directives": ["aifp_status"],
      "is_tool": true,
      "is_sub_helper": false,
      "calls_helpers": ["count_directives_by_type", "count_helpers_by_database", "get_project_metadata", "get_all_preferences"]
    },
    {
      "name": "query_mcp_relationships",
      "file_path": "src/aifp/helpers/mcp/orchestrators/relationship_queries.py",
      "database": "aifp_core.db",
      "target_database": "aifp_core",
      "purpose": "Query directive and helper relationships. Understand dependencies, interactions, and workflow patterns. Supports multi-level traversal (depth 1-3) and filtering by relationship type (depends_on, triggers, escalates_to, cross_links, uses_helpers, called_by).",
      "parameters": [
        {"name": "entity_type", "type": "str", "required": true, "values": ["directive", "helper"], "description": "Type of entity to query"},
        {"name": "entity_name", "type": "str", "required": true, "description": "Name of directive or helper"},
        {"name": "relationship_type", "type": "str", "required": false, "default": "all", "values": ["all", "depends_on", "triggers", "escalates_to", "cross_links", "uses_helpers", "used_by", "calls", "called_by"], "description": "Which relationships to include"},
        {"name": "depth", "type": "int", "required": false, "default": 1, "description": "Relationship depth (1-3): 1=direct, 2=relationships of relationships, 3=three levels deep"},
        {"name": "include_descriptions", "type": "bool", "required": false, "default": true, "description": "Include full descriptions of related entities"}
      ],
      "return_statements": [
        "Returns dict with entity_type, entity_name, relationships (depends_on, triggers, escalates_to, cross_links, uses_helpers for directives; used_by, calls, called_by for helpers)",
        "Each relationship includes name, type/level, description (if requested), relationship context",
        "Depth > 1 includes sub_relationships nested structure",
        "Total_relationships count provided",
        "Empty relationships if entity not found",
        "Warns about circular dependencies when depth limit reached",
        "Use for workflow visualization, dependency analysis, documentation generation, debugging directive chains"
      ],
      "error_handling": "Returns empty relationships if entity not found. Warns about circular dependencies (depth limit prevents infinite loops). Logs relationship queries.",
      "used_by_directives": [],
      "is_tool": true,
      "is_sub_helper": false,
      "calls_helpers": ["get_directive_interactions", "get_helper_relationships"]
    }
  ]
}
