{
  "metadata": {
    "version": "1.0.0",
    "last_updated": "2025-12-06",
    "description": "Project Database helpers - Core project table operations (project metadata: name, purpose, goals, status, version, blueprint tracking) and initialization",
    "database": "project.db",
    "target_database": "project",
    "total_helpers": 6,
    "schema_version": "1.0",
    "notes": "Project table is singular (one entry per database). These helpers manage the main project metadata distinct from infrastructure/files/tasks. Includes unified initialization helper for new and existing projects."
  },
  "helper_schema": {
    "description": "Schema definition for helper entries",
    "fields": {
      "name": "Function name",
      "file_path": "Path to implementation file",
      "database": "Which database this helper operates on",
      "target_database": "CHECK constraint value for aifp_core.db",
      "purpose": "Detailed description of what this helper does",
      "parameters": "Array of parameter objects with name and type",
      "return_statements": "Array of AI behavioral guidance - what to check/do next after calling this helper",
      "error_handling": "How errors are handled",
      "used_by_directives": "Array of directive names that use this helper",
      "is_tool": "Boolean - exposed via MCP as tool",
      "is_sub_helper": "Boolean - internal utility helper not directly called by AI/directives",
      "calls_helpers": "Array of helper names this function calls"
    }
  },
  "database": "project.db",
  "file_location": "src/aifp/helpers/project/",
  "helpers": [
    {
      "name": "initialize_aifp_project",
      "file_path": "src/aifp/helpers/project/initialization/init_project.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Unified initialization helper for new and existing projects. Creates .aifp-project/ directory structure, initializes all databases from schemas (project.db, user_preferences.db), creates blank ProjectBlueprint.md template. For existing projects: detects OOP code and enforces FP-only policy per docs/aifp-oop-policy.md.",
      "parameters": [
        {"name": "base_path", "type": "str", "required": true, "description": "Project root directory path where .aifp-project/ will be created"},
        {"name": "project_name", "type": "str", "required": true, "description": "Name of the project"},
        {"name": "project_type", "type": "str", "required": true, "description": "Type of project initialization: 'new' (empty project) or 'existing' (has code)"},
        {"name": "use_case", "type": "str", "required": false, "default": "development", "description": "Project use case: 'development' (regular software) or 'automation' (user directives)", "values": ["development", "automation"]},
        {"name": "project_purpose", "type": "str", "required": false, "default": null, "description": "Optional project purpose description"},
        {"name": "project_goals", "type": "dict", "required": false, "default": null, "description": "Optional project goals JSON object"}
      ],
      "return_statements": [
        "For new projects: Returns success status after creating structure and blank databases",
        "For existing projects: Scans codebase using AI Read/Grep tools to detect OOP patterns",
        "If OOP detected in existing project: AI evaluates project size (files, LOC, complexity)",
        "Large OOP projects: Firm rejection with message per aifp-oop-policy.md, recommend MCP removal",
        "Small OOP projects: Offer conversion with warnings, recommend rejection, allow new-directory option",
        "After successful init: AI must populate project entry using create_project helper",
        "AI must create completion_path stages using project workflow helpers",
        "AI must generate ProjectBlueprint.md content via directives (not by code)",
        "For automation use_case: Set user_directives_status field appropriately",
        "Next step: Call project_init directive to complete initialization workflow"
      ],
      "error_handling": "Returns error if .aifp-project/ already exists. Returns OOP rejection message if existing project contains OOP code (enforces FP-only policy). Handles file system errors gracefully. Validates base_path exists and is accessible.",
      "used_by_directives": ["project_init"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["create_project", "get_project"]
    },
    {
      "name": "create_project",
      "file_path": "src/aifp/helpers/project/mutations/project_mutations.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Create new project entry in project table. Only one project per database.",
      "parameters": [
        {"name": "name", "type": "str", "required": true},
        {"name": "purpose", "type": "str", "required": true},
        {"name": "goals", "type": "dict", "required": true, "description": "JSON object with project goals"},
        {"name": "status", "type": "str", "required": true, "description": "Project status (e.g., 'in_progress', 'completed')"},
        {"name": "version", "type": "str", "required": true},
        {"name": "user_directives_status", "type": "str", "required": false, "default": null, "description": "Status of user directives system (null, 'in_progress', 'active', 'disabled')"}
      ],
      "return_statements": [
        "Returns project_id (should always be 1)",
        "last_known_git_hash and last_git_sync fields populated automatically",
        "Only one project entry allowed per database",
        "Use this during project initialization",
        "After creating project, typically create completion path stages"
      ],
      "error_handling": "Returns error if project already exists (only one project per database).",
      "used_by_directives": ["project_init"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "get_project",
      "file_path": "src/aifp/helpers/project/queries/project_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Get the project entry. Returns entire project record since there's only one entry.",
      "parameters": [],
      "return_statements": [
        "Returns single project record or None if no project exists",
        "No need for special getters since there's only one entry",
        "Returns complete project metadata including git sync status",
        "Check user_directives_status to determine if user directives are active"
      ],
      "error_handling": "Returns None if no project entry exists.",
      "used_by_directives": ["aifp_status", "project_run"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "update_project",
      "file_path": "src/aifp/helpers/project/mutations/project_mutations.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Update project metadata. All parameters are optional (null = don't update).",
      "parameters": [
        {"name": "name", "type": "str", "required": false, "default": null},
        {"name": "purpose", "type": "str", "required": false, "default": null},
        {"name": "goals", "type": "dict", "required": false, "default": null, "description": "JSON object with project goals"},
        {"name": "status", "type": "str", "required": false, "default": null},
        {"name": "version", "type": "str", "required": false, "default": null},
        {"name": "user_directives_status", "type": "str", "required": false, "default": null}
      ],
      "return_statements": [
        "At least one parameter must be provided",
        "Updated_at timestamp set automatically by trigger",
        "Version changes should be accompanied by notes explaining evolution",
        "Status changes (e.g., to 'completed') should be validated against completion path"
      ],
      "error_handling": "Returns error if no update values provided or project doesn't exist.",
      "used_by_directives": ["project_evolution"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "blueprint_has_changed",
      "file_path": "src/aifp/helpers/project/queries/project_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Check if ProjectBlueprint.md has changed by comparing checksum against stored value.",
      "parameters": [],
      "return_statements": [
        "Returns true if blueprint checksum differs from stored value",
        "Returns false if blueprint unchanged",
        "Creates checksum of ProjectBlueprint.md file",
        "Compares against project.blueprint_checksum field",
        "If true, consider updating project version and running project_evolution"
      ],
      "error_handling": "Returns false if ProjectBlueprint.md doesn't exist or project entry missing.",
      "used_by_directives": ["aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "project_update_git_status",
      "file_path": "src/aifp/helpers/project/mutations/project_mutations.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Update project's last_known_git_hash and last_git_sync fields with current Git HEAD.",
      "parameters": [],
      "return_statements": [
        "No parameters needed - gets git data automatically",
        "Updates last_known_git_hash from current Git HEAD",
        "Updates last_git_sync to current timestamp",
        "Called after commits and during session initialization",
        "Enables external change detection via git_detect_external_changes"
      ],
      "error_handling": "Gracefully handles Git unavailability - logs warning but continues.",
      "used_by_directives": ["git_sync_state"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["get_current_commit_hash"]
    }
  ]
}
