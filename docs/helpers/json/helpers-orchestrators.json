{
  "helpers": [
    {
      "name": "aifp_run",
      "file_path": "helpers/orchestrators/orchestrators.py",
      "parameters": [
        {
          "name": "is_new_session",
          "type": "boolean",
          "required": false,
          "default": false,
          "description": "Whether this is a new session start. Use true for first interaction, new session, or after long breaks. Use false (default) for continuation work."
        }
      ],
      "purpose": "Main entry point orchestrator. Can be called on every user interaction or automatically on start. Optionally bundles comprehensive session startup data.",
      "error_handling": "Returns error message if database not accessible. Returns empty suggestions if no directives match.",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "If user setting project_continue_on_start=true and is_new_session=true: Automatically continue project work with bundled context instead of waiting for user command",
        "When autostart enabled: Load pending tasks from status, present with priority order, proactively suggest next steps for project completion"
      ],
      "implementation_notes": [
        "Returns: If is_new_session=true \u2192 bundles {status, user_settings, fp_directive_index, all_directive_names[], infrastructure_data, guidance}",
        "Returns: If is_new_session=false \u2192 lightweight {guidance, common_starting_points[]}",
        "Session bundle calls: aifp_status(), get_user_settings(), get_fp_directive_index(), get_all_directive_names(), get_all_infrastructure()",
        "Directive names only - NOT full directive data (AI queries by name when needs details)",
        "fp_directive_index: FP directive names grouped by category for quick reference",
        "all_directive_names: Complete list of ALL directive names (project, fp, user, git) for AI to know what's available",
        "Does NOT parse user input or match intent - returns static guidance only",
        "AI receives guidance and makes own decisions about which directives to apply",
        "Called on EVERY interaction to keep AI on track with AIFP directives",
        "Session bundle is ~15.5-20.5k tokens: status (~10k) + settings (~1k) + fp_index (~2k) + directive_names (~1k) + infrastructure (~500) + guidance (~2k)",
        "Always includes guidance on when to call aifp_run(is_new_session=true) again"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_run",
          "execution_context": "self_invocation",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {},
          "description": "aifp_run directive uses aifp_run helper as entry point orchestrator"
        }
      ]
    },
    {
      "name": "aifp_init",
      "file_path": "helpers/orchestrators/orchestrators.py",
      "parameters": [
        {
          "name": "project_root",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Path to project root directory"
        }
      ],
      "purpose": "Phase 1 mechanical setup orchestrator for project initialization. Atomically creates directories, databases with schemas, and templates. No deep logic - pure mechanical operations.",
      "error_handling": "Return detailed error if: already initialized, directory permissions denied, database creation failed. Clean up partial initialization on error (delete .aifp-project/ if incomplete).",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "AI must now detect and populate infrastructure values (language, build tool, source directory)",
        "Prompt user for project name, purpose, and goals to populate ProjectBlueprint.md",
        "After populating source_directory: call aifp_init's state DB creation code to set up {source_dir}/.state/",
        "Empty infrastructure entries signal what needs AI detection/population"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "project_init",
          "execution_context": "phase_1_mechanical_setup",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "project_root": "from current working directory or user input"
          },
          "description": "project_init directive calls aifp_init for Phase 1 mechanical setup"
        }
      ],
      "implementation_notes": [
        "PHASE 1 ONLY - Mechanical setup with no intelligence",
        "Step 1: Check if already initialized (error if .aifp-project/project.db exists)",
        "Step 2: Create directories: .aifp-project/, .aifp-project/backups/",
        "Step 3: Copy ProjectBlueprint_template.md to .aifp-project/ProjectBlueprint.md",
        "Step 4: Initialize project.db: load schemas/project.sql, execute, then execute initialization/standard_infrastructure.sql (8 empty entries), then call update_project_root() to populate project_root value",
        "Step 5: Initialize user_preferences.db: load schemas/user_preferences.sql, execute, INSERT default tracking_settings (all disabled)",
        "Step 6: Create .gitkeep files for empty directories",
        "Step 7: Validate all files and tables exist (call validate_initialization helper)",
        "Step 8: Return success object",
        "RETURN STRUCTURE: {success: bool, project_root: str, aifp_dir: str, files_created: ['.aifp-project/', 'project.db', 'user_preferences.db', 'ProjectBlueprint.md'], tables_created: {project_db: [...], user_prefs_db: [...]}, infrastructure_entries: 8, next_phase: 'AI populates infrastructure and blueprint'}",
        "State database creation: Code lives in aifp_init module. Called after AI populates source_directory (Phase 2). Creates {source_dir}/.state/runtime.db, README.md, state_operations.{ext}",
        "State DB purpose: FP-compliant mutable global state (key-value store with CRUD reference file)",
        "State DB templates located at: src/aifp/templates/state_db/ (runtime.db, README.md, state_operations.py)",
        "ERROR CLEANUP: If any step fails after Step 2, delete .aifp-project/ directory entirely (shutil.rmtree). Partial initialization is worse than no initialization.",
        "ERROR RETURN: {success: false, error: str, failed_step: int, cleanup_performed: bool}",
        "All operations are direct file/DB operations - no helper calls except validate_initialization"
      ]
    },
    {
      "name": "get_current_progress",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "scope",
          "type": "string",
          "required": false,
          "default": null,
          "description": "What information to retrieve"
        },
        {
          "name": "detail_level",
          "type": "string",
          "required": false,
          "default": null,
          "description": "How much detail to return"
        },
        {
          "name": "filters",
          "type": "object",
          "required": false,
          "default": null,
          "description": "WHERE-like conditions"
        }
      ],
      "purpose": "Single entry point for all project status queries. Replaces 5-10 separate helper calls with one flexible query.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: Flexible object based on scope and detail_level parameters",
        "Replaces multiple separate queries with unified interface",
        "Filters support: {field: value} or {field: {operator: value}}",
        "Default detail_level='standard' returns reasonable data without overwhelming"
      ],
      "target_database": "orchestrator",
      "used_by_directives": []
    },
    {
      "name": "update_project_state",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "action",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Operation to perform"
        },
        {
          "name": "target_type",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Entity type"
        },
        {
          "name": "target_id",
          "type": "integer",
          "required": true,
          "default": null,
          "description": "ID of target entity"
        },
        {
          "name": "data",
          "type": "object",
          "required": false,
          "default": null,
          "description": "Action-specific data"
        },
        {
          "name": "create_note",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "Auto-log action as note"
        }
      ],
      "purpose": "Single entry point for common project state updates. Simplifies task lifecycle management and progress tracking.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: {success, updated_entity{}, note_created?}",
        "Actions: start_task, complete_task, pause_task, resume_task, block_task, unblock_task",
        "Updates entity status field and related timestamps",
        "If create_note=true \u2192 inserts note record automatically",
        "Simplifies common state transitions with action-based interface"
      ],
      "target_database": "orchestrator",
      "used_by_directives": []
    },
    {
      "name": "batch_update_progress",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "updates",
          "type": "array",
          "required": true,
          "default": null,
          "description": "List of update operation objects"
        },
        {
          "name": "transaction",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "All-or-nothing commit vs independent updates"
        },
        {
          "name": "continue_on_error",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "Stop on first error or continue processing"
        },
        {
          "name": "rollback_on_partial_failure",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "If transaction=true and any update fails, rollback all"
        }
      ],
      "purpose": "Update multiple project items atomically. Used after code generation or bulk operations to ensure consistency.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: {success, updated_count, failed_count, results[{success, entity, error?}]}",
        "Updates array: [{target_type, target_id, action, data}, ...]",
        "Transaction=true uses database transactions for atomicity",
        "Continue_on_error=true processes all updates even if some fail",
        "Rollback_on_partial_failure=true undoes all if any fail (requires transaction=true)"
      ],
      "target_database": "orchestrator",
      "used_by_directives": []
    },
    {
      "name": "query_project_state",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "entity",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Primary table to query"
        },
        {
          "name": "filters",
          "type": "object",
          "required": false,
          "default": null,
          "description": "WHERE-like conditions with operators"
        },
        {
          "name": "joins",
          "type": "array",
          "required": false,
          "default": null,
          "description": "Relations to include (LEFT JOIN)"
        },
        {
          "name": "sort",
          "type": "string",
          "required": false,
          "default": null,
          "description": "ORDER BY clause"
        },
        {
          "name": "limit",
          "type": "integer",
          "required": false,
          "default": null,
          "description": "Maximum results (pagination)"
        },
        {
          "name": "offset",
          "type": "integer",
          "required": false,
          "default": null,
          "description": "Skip first N results (pagination)"
        }
      ],
      "purpose": "Flexible SQL-like query interface for complex project queries. Provides powerful filtering and joining capabilities without writing SQL.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: Array of entity objects with joins embedded",
        "Filters support operators: eq, ne, gt, lt, gte, lte, in, like",
        "Joins uses LEFT JOIN to include related entities",
        "Sort: 'field ASC' or 'field DESC'",
        "Powerful SQL-like interface without writing raw SQL"
      ],
      "target_database": "orchestrator",
      "used_by_directives": []
    },
    {
      "name": "validate_initialization",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "aifp_dir",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Path to .aifp-project/ directory"
        }
      ],
      "purpose": "Validate that project initialization is complete and correct. Performs comprehensive structural validation.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: {valid, errors[], warnings[], checked_components{}}",
        "Checks: directory structure, database files, tables, blueprint file",
        "Comprehensive validation - catches missing/corrupted setup",
        "Detailed error reporting for troubleshooting"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_status",
          "execution_context": "check_initialization_status",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "aifp_dir": ".aifp-project/"
          },
          "description": "Validate project initialization status before providing status report - checks directory structure, databases, tables, blueprint"
        }
      ]
    },
    {
      "name": "get_work_context",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "work_item_type",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Type of work item"
        },
        {
          "name": "work_item_id",
          "type": "integer",
          "required": true,
          "default": null,
          "description": "ID of work item"
        },
        {
          "name": "include_interactions",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "Include function dependency interactions"
        },
        {
          "name": "include_history",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "Include note history for work item"
        }
      ],
      "purpose": "Get complete context for resuming work. Single call retrieves task/subtask/sidequest + flows + files + functions + interactions. Optimized for session resumption.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: {work_item{}, flows[], files[], functions[], interactions[]?, notes[]?}",
        "Single optimized query with joins across multiple tables",
        "Include_interactions=true adds function dependency data",
        "Include_history=true adds notes timeline",
        "Optimized for session resumption - all context in one call"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "project_auto_resume",
          "execution_context": "load_work_context",
          "sequence_order": 3,
          "is_required": true,
          "parameters_mapping": {
            "work_item_type": "detected_work_item_type (task, subtask, sidequest)",
            "work_item_id": "last_incomplete_work_item_id",
            "include_interactions": "true",
            "include_history": "true"
          },
          "description": "Load complete work context for resuming interrupted work - retrieves work item details, associated flows, files, functions, interactions, and note history in single optimized query"
        }
      ]
    },
    {
      "name": "aifp_status",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "type",
          "type": "string",
          "required": false,
          "default": "summary",
          "description": "'quick', 'summary', 'detailed' - level of detail to return"
        }
      ],
      "purpose": "Status orchestrator that retrieves comprehensive project state. Gathers data from multiple tables for AI to determine next steps.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns status object with: work_hierarchy, incomplete_tasks[], incomplete_items[], recent_completions[], blocked_items[], progress_counts, git_state, infrastructure_status",
        "Calls get_project_status() to retrieve work hierarchy data",
        "Calls get_status_tree() to build hierarchical view",
        "Type='quick': Counts and current work item only",
        "Type='summary': Standard detail - incomplete items, recent context (default)",
        "Type='detailed': Full data including all history",
        "NO suggestion logic - AI determines appropriate next directive from returned data"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_status",
          "execution_context": "self_invocation",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {},
          "description": "aifp_status directive uses aifp_status helper to retrieve comprehensive project state - AI determines next steps from returned data"
        },
        {
          "directive_name": "aifp_run",
          "execution_context": "get_status_when_requested",
          "sequence_order": 2,
          "is_required": false,
          "parameters_mapping": {},
          "description": "Called by aifp_run when get_status=true parameter is passed - provides comprehensive status for fresh context"
        }
      ]
    },
    {
      "name": "get_project_status",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "type",
          "type": "string",
          "required": false,
          "default": "summary",
          "description": "'quick', 'summary', 'detailed' - how much data to retrieve"
        }
      ],
      "purpose": "Retrieve work hierarchy data from project database. Returns structured data for AI to understand project state.",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": true,
      "return_statements": [],
      "implementation_notes": [
        "Returns: {completion_paths[], milestones[], tasks[], subtasks[], sidequests[], counts{}, blocked_items[]}",
        "Retrieves data from multiple tables with JOINs for context",
        "Counts are simple aggregates (COUNT WHERE status != 'completed')",
        "Type='quick': Counts and current incomplete item only",
        "Type='summary': Incomplete items + last few completed for context (default)",
        "Type='detailed': All items including completed history",
        "NO analysis logic - returns raw data with basic counts, AI interprets meaning"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_status",
          "execution_context": "retrieve_work_hierarchy",
          "sequence_order": 2,
          "is_required": true,
          "parameters_mapping": {},
          "description": "Sub-helper used by aifp_status to retrieve work hierarchy data (completion paths, milestones, tasks, subtasks, sidequests)"
        }
      ]
    },
    {
      "name": "get_project_context",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "type",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Context type: \"blueprint\", \"metadata\", \"status\", \"infrastructure\""
        }
      ],
      "purpose": "Get structured project overview for different contexts",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns different structures based on type parameter",
        "Type='blueprint': {blueprint_content, file_path}",
        "Type='metadata': {name, description, use_case, version, settings}",
        "Type='status': {basic_status, work_counts, git_hash}",
        "Type='infrastructure': {helpers[], directives[], settings[]}"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_help",
          "execution_context": "show_project_info",
          "sequence_order": 13,
          "is_required": false,
          "parameters_mapping": {
            "type": "metadata or infrastructure (based on user query)"
          },
          "description": "Show project metadata or infrastructure when user requests project information - provides structured overview of project setup, settings, available helpers/directives"
        }
      ]
    },
    {
      "name": "get_status_tree",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [],
      "purpose": "Build hierarchical view of work items with nested structure from flat database tables",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": true,
      "return_statements": [],
      "implementation_notes": [
        "Returns: Nested tree structure with work items embedded under parents",
        "Format: {completion_paths[{milestones[{tasks[{subtasks[]}]}]}], sidequests[]}",
        "Queries tables and structures data by parent-child relationships",
        "Pure data transformation - no decision logic"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "aifp_status",
          "execution_context": "build_status_tree",
          "sequence_order": 3,
          "is_required": true,
          "parameters_mapping": {},
          "description": "Sub-helper used by aifp_status to build hierarchical tree view of work items"
        }
      ]
    },
    {
      "name": "get_files_by_flow_context",
      "file_path": "TODO_helpers/orchestrator/module.py",
      "parameters": [
        {
          "name": "flow_id",
          "type": "integer",
          "required": true,
          "default": null,
          "description": "Flow ID"
        }
      ],
      "purpose": "Get all files for a flow with functions embedded",
      "error_handling": "",
      "is_tool": false,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: Array of file objects with functions[] embedded",
        "Queries file_flows table for flow_id, retrieves associated files",
        "For each file, embeds functions from functions table",
        "Provides complete view of flow implementation"
      ],
      "target_database": "orchestrator",
      "used_by_directives": [
        {
          "directive_name": "project_dependency_map",
          "execution_context": "map_flow_dependencies",
          "sequence_order": 6,
          "is_required": true,
          "parameters_mapping": {
            "flow_id": "current_flow_id_from_flows_loop"
          },
          "description": "Get all files implementing a flow with embedded functions - used to build dependency map showing file-flow-function relationships"
        }
      ]
    }
  ],
  "metadata": {
    "file": "helpers-orchestrators.json",
    "count": 12,
    "status": "reviewed 2026-01-27 - removed deep logic language",
    "last_updated": "2026-01-27",
    "notes": "All helpers are data retrieval operations. NO analysis/suggestion logic - AI interprets returned data and decides next steps."
  }
}