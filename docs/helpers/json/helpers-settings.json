{
  "helpers": [
    {
      "name": "user_preferences_allowed_check_constraints",
      "file_path": "helpers/user_preferences/validation.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name to check for CHECK constraints"
        },
        {
          "name": "field",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Field name to get allowed values for"
        }
      ],
      "purpose": "Returns list of allowed values for CHECK constraint enum fields in user_preferences.db. Parses schema to extract CHECK(field IN (...)) constraints.",
      "error_handling": "Returns error if table does not exist, field does not exist, or field does not have a CHECK constraint list",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "Returns array of allowed string values: [\"value1\", \"value2\", ...]",
        "Error: \"Table {table} not found in user_preferences database\"",
        "Error: \"Field {field} not found in table {table}\"",
        "Error: \"Field {field} does not have a CHECK constraint list\""
      ],
      "target_database": "user_preferences",
      "used_by_directives": [],
      "implementation_notes": [
        "Parse schema SQL for table definition",
        "Find field with CHECK constraint: CHECK (field IN (...))",
        "Extract values from IN clause",
        "Return as array of strings",
        "Examples: user_preferences_allowed_check_constraints(\"tracking_settings\", \"feature_name\") -> [\"fp_flow_tracking\", \"ai_interaction_log\", \"helper_function_logging\", \"issue_reports\", \"compliance_checking\"]",
        "Examples: user_preferences_allowed_check_constraints(\"tracking_settings\", \"status\") -> [\"enabled\", \"disabled\"]"
      ]
    },
    {
      "name": "get_settings_tables",
      "file_path": "helpers/user_preferences/schema.py",
      "parameters": [],
      "purpose": "List all tables in user settings database",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_settings_fields",
      "file_path": "helpers/user_preferences/schema.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name to get fields for"
        }
      ],
      "purpose": "Get field names and types for a specific table",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_settings_schema",
      "file_path": "helpers/user_preferences/schema.py",
      "parameters": [],
      "purpose": "Get complete schema for user settings database",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_settings_json_parameters",
      "file_path": "helpers/user_preferences/schema.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name to get available fields for"
        }
      ],
      "purpose": "Get available fields for table to use with generic add/update operations",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_from_settings",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name"
        },
        {
          "name": "id_array",
          "type": "integer",
          "required": true,
          "default": null,
          "description": "**MUST contain at least one ID**"
        }
      ],
      "purpose": "Get records by ID(s) - **EMPTY ARRAY NOT ALLOWED**",
      "error_handling": "Return error if id_array is empty",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_from_settings_where",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "conditions",
          "type": "object",
          "required": true,
          "default": null,
          "description": "Field-value pairs (AND logic)"
        }
      ],
      "purpose": "Flexible filtering with structured JSON conditions",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "query_settings",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name in user_preferences.db"
        },
        {
          "name": "where_clause",
          "type": "string",
          "required": false,
          "default": null,
          "description": "SQL WHERE clause for filtering"
        }
      ],
      "purpose": "Execute complex SQL WHERE clause (advanced, rare use)",
      "error_handling": "Returns empty array if no matches",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_sync",
          "execution_context": "load_preferences",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "table": "directive_preferences",
            "where_clause": "WHERE directive_name=? AND active=1"
          },
          "description": "Query directive-specific preferences before executing customizable directives"
        },
        {
          "directive_name": "tracking_toggle",
          "execution_context": "check_current_status",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "table": "tracking_settings",
            "where_clause": "WHERE feature_name=?"
          },
          "description": "Check if tracking feature currently enabled before toggling"
        },
        {
          "directive_name": "user_preferences_export",
          "execution_context": "query_preferences",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "table": "user_settings, directive_preferences, (optional) ai_interaction_log, fp_flow_tracking"
          },
          "description": "Query all preferences and optionally tracking data for export to JSON file"
        }
      ]
    },
    {
      "name": "add_settings_entry",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name"
        },
        {
          "name": "data",
          "type": "object",
          "required": true,
          "default": null,
          "description": "Field-value pairs"
        }
      ],
      "purpose": "Add entry to user settings database",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_import",
          "execution_context": "import_preferences",
          "sequence_order": 2,
          "is_required": true,
          "parameters_mapping": {
            "table": "user_settings, directive_preferences",
            "entry_json": "workflow.imported_preferences"
          },
          "description": "Insert imported preferences from JSON file - bulk insert for user_settings and directive_preferences tables"
        }
      ]
    },
    {
      "name": "update_settings_entry",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name in user_preferences.db"
        },
        {
          "name": "entry_json",
          "type": "object",
          "required": true,
          "default": null,
          "description": "JSON object with fields to update/insert (upsert)"
        }
      ],
      "purpose": "Update entry in user settings database",
      "error_handling": "Returns error if table not found or validation fails",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_update",
          "execution_context": "update_or_insert",
          "sequence_order": 2,
          "is_required": true,
          "parameters_mapping": {
            "table": "directive_preferences",
            "entry_json": "{directive_name, preference_key, preference_value, description, active=1}"
          },
          "description": "Upsert user preference for specific directive after user confirms change"
        },
        {
          "directive_name": "tracking_toggle",
          "execution_context": "update_tracking_setting",
          "sequence_order": 2,
          "is_required": true,
          "parameters_mapping": {
            "table": "tracking_settings",
            "entry_json": "{feature_name, enabled=true/false}"
          },
          "description": "Toggle tracking feature on or off in tracking_settings table"
        }
      ]
    },
    {
      "name": "delete_settings_entry",
      "file_path": "helpers/user_preferences/crud.py",
      "parameters": [
        {
          "name": "table",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Table name in user_preferences.db"
        },
        {
          "name": "id",
          "type": "integer",
          "required": true,
          "default": null,
          "description": "Record ID to delete"
        }
      ],
      "purpose": "Delete entry from user_preferences.db table",
      "error_handling": "Returns error if table not found or ID doesn't exist",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "load_directive_preferences",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "directive_name",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Directive name to load preferences for"
        }
      ],
      "purpose": "Load all active preferences for a directive (high-frequency)",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_sync",
          "execution_context": "load_preferences",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "directive_name": "workflow.current_directive"
          },
          "description": "Load active preferences for directive before execution - returns preference key-value pairs for current directive context"
        }
      ]
    },
    {
      "name": "add_directive_preference",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "directive_name",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Directive name"
        },
        {
          "name": "preference_key",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Preference key"
        },
        {
          "name": "preference_value",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Preference value"
        },
        {
          "name": "active",
          "type": "boolean",
          "required": false,
          "default": true,
          "description": "Whether preference is active"
        }
      ],
      "purpose": "Add/update user preference for directive",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_update",
          "execution_context": "update_or_insert",
          "sequence_order": 2,
          "is_required": true,
          "parameters_mapping": {
            "directive_name": "workflow.confirmed_directive",
            "preference_key": "workflow.extracted_key",
            "preference_value": "workflow.extracted_value"
          },
          "description": "Add or update directive-specific preference after user confirms - atomic key-value upsert"
        },
        {
          "directive_name": "user_preferences_learn",
          "execution_context": "update_directive_preferences",
          "sequence_order": 3,
          "is_required": true,
          "parameters_mapping": {},
          "description": "Store learned preference from user corrections after user confirms - inferred from user behavior patterns"
        }
      ]
    },
    {
      "name": "update_directive_preference",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "directive_name",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Directive name"
        },
        {
          "name": "preference_key",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Preference key to update (must exist)"
        },
        {
          "name": "preference_value",
          "type": "string",
          "required": false,
          "default": null,
          "description": "New preference value"
        },
        {
          "name": "active",
          "type": "boolean",
          "required": false,
          "default": null,
          "description": "Update active status"
        },
        {
          "name": "description",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Update description"
        }
      ],
      "purpose": "Update existing directive preference in directive_preferences table",
      "error_handling": "Returns error if directive_name + preference_key combination not found",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "Returns: {success: true, directive_name, preference_key, message: 'Preference updated'}",
        "Error: 'Preference {preference_key} for directive {directive_name} not found'"
      ],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_update",
          "execution_context": "update_existing_preference",
          "sequence_order": 2,
          "is_required": false,
          "parameters_mapping": {
            "directive_name": "workflow.confirmed_directive",
            "preference_key": "workflow.extracted_key",
            "preference_value": "workflow.new_value"
          },
          "description": "Update existing directive preference value or active status"
        }
      ],
      "implementation_notes": [
        "UPDATE directive_preferences SET preference_value=?, active=?, description=? WHERE directive_name=? AND preference_key=?",
        "Only updates fields that are provided (non-null)",
        "Companion to add_directive_preference - use add for new, update for existing",
        "Separate from generic update_settings_entry for high-frequency table operations"
      ]
    },
    {
      "name": "get_user_setting",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "setting_key",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Setting key to retrieve"
        }
      ],
      "purpose": "Get project-wide user setting by key (fairly frequent)",
      "error_handling": "Returns null if setting_key not found",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "Returns: {setting_key, setting_value, description, scope} or null if not found"
      ],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "add_user_setting",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "setting_key",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Setting key (must be unique)"
        },
        {
          "name": "setting_value",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Setting value"
        },
        {
          "name": "description",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Description of the setting"
        },
        {
          "name": "scope",
          "type": "string",
          "required": false,
          "default": "project",
          "description": "Setting scope (default 'project')"
        }
      ],
      "purpose": "Add new project-wide user setting to user_settings table",
      "error_handling": "Returns error if setting_key already exists (use update_user_setting instead)",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "Returns: {success: true, setting_key, message: 'Setting added'}",
        "Error: 'Setting with key {setting_key} already exists'"
      ],
      "target_database": "user_preferences",
      "used_by_directives": [],
      "implementation_notes": [
        "INSERT INTO user_settings (setting_key, setting_value, description, scope) VALUES (?, ?, ?, ?)",
        "Companion to update_user_setting - use add for new, update for existing",
        "Separate from generic add_settings_entry for high-frequency table operations"
      ]
    },
    {
      "name": "update_user_setting",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "setting_key",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Setting key to update (must exist)"
        },
        {
          "name": "setting_value",
          "type": "string",
          "required": false,
          "default": null,
          "description": "New setting value"
        },
        {
          "name": "description",
          "type": "string",
          "required": false,
          "default": null,
          "description": "New description (optional)"
        },
        {
          "name": "scope",
          "type": "string",
          "required": false,
          "default": null,
          "description": "New scope (optional)"
        }
      ],
      "purpose": "Update existing project-wide user setting in user_settings table",
      "error_handling": "Returns error if setting_key not found (use add_user_setting instead)",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [
        "Returns: {success: true, setting_key, message: 'Setting updated'}",
        "Error: 'Setting with key {setting_key} not found'"
      ],
      "target_database": "user_preferences",
      "used_by_directives": [],
      "implementation_notes": [
        "UPDATE user_settings SET setting_value=?, description=?, scope=? WHERE setting_key=?",
        "Only updates fields that are provided (non-null)",
        "Companion to add_user_setting - use add for new, update for existing",
        "Separate from generic update_settings_entry for high-frequency table operations"
      ]
    },
    {
      "name": "get_tracking_settings",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [],
      "purpose": "Get all tracking feature flags",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "user_preferences_sync",
          "execution_context": "enable_logging",
          "sequence_order": 3,
          "is_required": false,
          "parameters_mapping": {},
          "description": "Check which tracking features are enabled (fp_flow_tracking, ai_interaction_log, helper_function_logging, issue_reports) to enable appropriate logging"
        },
        {
          "directive_name": "tracking_toggle",
          "execution_context": "show_current_status",
          "sequence_order": 2,
          "is_required": false,
          "parameters_mapping": {},
          "description": "Get all tracking settings to show user current status before/after toggle - displays which features are enabled"
        }
      ]
    },
    {
      "name": "toggle_tracking_feature",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "feature_name",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Tracking feature name"
        },
        {
          "name": "enabled",
          "type": "boolean",
          "required": true,
          "default": null,
          "description": "Enable or disable"
        }
      ],
      "purpose": "Enable/disable tracking feature",
      "error_handling": "",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "tracking_toggle",
          "execution_context": "self_implementation",
          "sequence_order": 1,
          "is_required": true,
          "parameters_mapping": {
            "feature_name": "workflow.identified_feature",
            "enabled": "workflow.enable_or_disable"
          },
          "description": "Tool that implements tracking_toggle directive - shows token overhead warning when enabling, toggles tracking feature flag in tracking_settings table, confirms new status with user"
        }
      ]
    },
    {
      "name": "get_user_settings",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [],
      "purpose": "Get all user settings from user_settings table (complements get_user_setting which gets one setting by key)",
      "error_handling": "Returns empty array if no settings exist",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "implementation_notes": [
        "Returns: Array of {setting_key, setting_value, description, scope}",
        "Query: SELECT setting_key, setting_value, description, scope FROM user_settings",
        "Complements singular get_user_setting(key) - this returns all settings",
        "Used for bundling all settings at session startup",
        "Lightweight - typically only 3-5 project-wide settings"
      ],
      "target_database": "user_preferences",
      "used_by_directives": [
        {
          "directive_name": "aifp_run",
          "execution_context": "new_session_startup",
          "sequence_order": 2,
          "is_required": false,
          "parameters_mapping": {},
          "description": "Called by aifp_run when is_new_session=true - returns all user settings for session cache"
        }
      ]
    },
    {
      "name": "add_tracking_note",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "content",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Note content/message"
        },
        {
          "name": "note_type",
          "type": "string",
          "required": true,
          "default": null,
          "description": "'fp_analysis', 'user_interaction', 'validation', 'performance', 'debug'"
        },
        {
          "name": "reference_type",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Type of reference (e.g., 'function', 'file', 'directive')"
        },
        {
          "name": "reference_name",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Name of referenced entity (e.g., function name, file path)"
        },
        {
          "name": "reference_id",
          "type": "integer",
          "required": false,
          "default": null,
          "description": "Optional ID if referencing project.db entity"
        },
        {
          "name": "directive_name",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Directive that created this note"
        },
        {
          "name": "severity",
          "type": "string",
          "required": false,
          "default": "info",
          "description": "'info', 'warning', 'error' (default 'info')"
        },
        {
          "name": "metadata_json",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Additional context as JSON string"
        }
      ],
      "purpose": "Add tracking note to user_preferences.db (only when tracking enabled)",
      "error_handling": "Returns error if tracking not enabled or note_type invalid",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "get_tracking_notes",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "note_type",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Filter by note_type"
        },
        {
          "name": "reference_type",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Filter by reference_type"
        },
        {
          "name": "reference_name",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Filter by reference_name"
        },
        {
          "name": "directive_name",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Filter by directive_name"
        },
        {
          "name": "severity",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Filter by severity"
        }
      ],
      "purpose": "Get tracking notes with optional filters",
      "error_handling": "Returns empty array if no matches",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    },
    {
      "name": "search_tracking_notes",
      "file_path": "helpers/user_preferences/management.py",
      "parameters": [
        {
          "name": "search_string",
          "type": "string",
          "required": true,
          "default": null,
          "description": "Search string for note content"
        },
        {
          "name": "note_type",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Optional filter by note_type"
        },
        {
          "name": "reference_type",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Optional filter by reference_type"
        },
        {
          "name": "directive_name",
          "type": "string",
          "required": false,
          "default": null,
          "description": "Optional filter by directive_name"
        }
      ],
      "purpose": "Search tracking note content with optional filters",
      "error_handling": "Returns empty array if no matches",
      "is_tool": true,
      "is_sub_helper": false,
      "return_statements": [],
      "target_database": "user_preferences",
      "used_by_directives": []
    }
  ],
  "metadata": {
    "file": "helpers-settings.json",
    "count": 23,
    "first_helper": "user_preferences_allowed_check_constraints",
    "status": "COMPLETE - All 23 helpers implemented",
    "mapped_helpers": 8,
    "unmapped_helpers": 15,
    "note": "All helpers implemented in src/aifp/helpers/user_preferences/. Distribution: validation.py (1), schema.py (4), crud.py (6), management.py (12). 8 helpers mapped to user preference directives, 15 are generic AI query tools.",
    "total_mappings": 12,
    "last_updated": "2026-01-27",
    "changes": [
      "2026-01-27: Removed apply_preferences_to_context, update_user_preferences. Added update_directive_preference, add_user_setting, update_user_setting.",
      "2026-01-27: All 23 helpers implemented. Phase 5 COMPLETE."
    ]
  }
}