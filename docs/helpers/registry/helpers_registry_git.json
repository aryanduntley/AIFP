{
  "metadata": {
    "version": "1.0.0",
    "last_updated": "2025-11-29",
    "description": "Git Integration helpers - Version control operations (branch management, conflict detection, FP-powered merging, external change detection)",
    "database": "project.db",
    "target_database": "project",
    "total_helpers": 10,
    "schema_version": "1.0",
    "notes": "Git helpers manage version control integration, multi-user collaboration, and FP-powered conflict resolution. Used by Git directives."
  },
  "helper_schema": {
    "description": "Schema definition for helper entries",
    "fields": {
      "name": "Function name",
      "file_path": "Path to implementation file",
      "database": "Which database this helper operates on",
      "target_database": "CHECK constraint value for aifp_core.db",
      "purpose": "Detailed description of what this helper does",
      "parameters": "Array of parameter objects with name and type",
      "return_statements": "Array of AI behavioral guidance - what to check/do next after calling this helper",
      "error_handling": "How errors are handled",
      "used_by_directives": "Array of directive names that use this helper",
      "is_tool": "Boolean - exposed via MCP as tool",
      "is_sub_helper": "Boolean - internal utility helper not directly called by AI/directives",
      "calls_helpers": "Array of helper names this function calls"
    }
  },
  "database": "project.db",
  "file_location": "src/aifp/helpers/git/",
  "helpers": [
    {
      "name": "get_current_commit_hash",
      "file_path": "src/aifp/helpers/git/git_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Get current Git HEAD commit hash for external change detection.",
      "parameters": [
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns string commit hash or None if Git unavailable",
        "Use for external change detection",
        "Compare with project.last_known_git_hash to detect changes",
        "Called by git_sync_state and detect_external_changes"
      ],
      "error_handling": "Returns None if Git unavailable or not a Git repository.",
      "used_by_directives": ["git_init", "git_sync_state", "git_detect_external_changes"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "get_current_branch",
      "file_path": "src/aifp/helpers/git/git_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Get current Git branch name.",
      "parameters": [
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns string branch name or None if Git unavailable",
        "Use for status reporting and branch validation",
        "Common in multi-user collaboration workflows"
      ],
      "error_handling": "Returns None if Git unavailable.",
      "used_by_directives": ["git_create_branch", "git_sync_state", "aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "get_git_status",
      "file_path": "src/aifp/helpers/git/git_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Convenience wrapper combining multiple Git status queries. Returns comprehensive Git state.",
      "parameters": [
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with git_available, current_branch, commit_hash, uncommitted_changes, external_changes_detected",
        "Single call provides complete Git state snapshot",
        "Gracefully handles missing project.db",
        "Use for comprehensive status reporting"
      ],
      "error_handling": "Returns dict with git_available=False if Git unavailable.",
      "used_by_directives": ["git_sync_state", "aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["get_current_branch", "get_current_commit_hash", "detect_external_changes"]
    },
    {
      "name": "detect_external_changes",
      "file_path": "src/aifp/helpers/git/git_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Compare current Git HEAD with project.last_known_git_hash to detect external code modifications.",
      "parameters": [
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with changes_detected (bool), previous_hash, current_hash, files_changed (array)",
        "Detects code changes made outside AIFP sessions",
        "If changes detected, consider running file sync to update project.db",
        "Lists specific files that changed"
      ],
      "error_handling": "Returns empty changes if Git unavailable or hash missing.",
      "used_by_directives": ["git_detect_external_changes", "aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["get_current_commit_hash"]
    },
    {
      "name": "create_user_branch",
      "file_path": "src/aifp/helpers/git/git_mutations.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Create new work branch following naming convention aifp-{user}-{number}.",
      "parameters": [
        {"name": "user", "type": "str", "required": true},
        {"name": "purpose", "type": "str", "required": true},
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with success (bool), branch_name (string), branch_number (int)",
        "Branch name format: aifp-{user}-{number}",
        "Auto-increments number if branch exists",
        "Records branch in work_branches table",
        "After creating branch, typically start working on tasks"
      ],
      "error_handling": "Increments number if branch exists, prompts user if Git fails.",
      "used_by_directives": ["git_create_branch"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "detect_conflicts_before_merge",
      "file_path": "src/aifp/helpers/git/git_conflict_analysis.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "FP-powered conflict analysis before merging. Queries project.db from both branches to analyze function purity, dependencies, and tests.",
      "parameters": [
        {"name": "source_branch", "type": "str", "required": true},
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with conflicts_detected (bool), file_conflicts (array), function_conflicts (array), confidence_scores (object)",
        "Analyzes purity levels and test results from both branches",
        "High-purity functions with passing tests get higher confidence",
        "Use confidence_scores to determine auto-resolve eligibility",
        "Confidence >0.8 eligible for auto-resolution"
      ],
      "error_handling": "Falls back to file-level conflicts if DB query fails.",
      "used_by_directives": ["git_detect_conflicts", "git_merge_branch"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "merge_with_fp_intelligence",
      "file_path": "src/aifp/helpers/git/git_merge.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Perform Git merge with FP-powered conflict resolution. Auto-resolves high-confidence conflicts (>0.8) using purity analysis.",
      "parameters": [
        {"name": "source_branch", "type": "str", "required": true},
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with success (bool), auto_resolved_count (int), manual_conflicts (array), merge_aborted (bool)",
        "Auto-resolves conflicts with confidence >0.8",
        "Pure functions with passing tests preferred",
        "Manual conflicts require user intervention",
        "If merge aborted, runs 'git merge --abort'",
        "Records resolution decisions in merge_history table"
      ],
      "error_handling": "Aborts merge (git merge --abort) if unresolvable conflicts.",
      "used_by_directives": ["git_merge_branch"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["detect_conflicts_before_merge"]
    },
    {
      "name": "get_user_name_for_branch",
      "file_path": "src/aifp/helpers/git/git_user.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Detect user name for branch creation from multiple sources (git config, environment, system).",
      "parameters": [],
      "return_statements": [
        "Returns string username (never None - always returns valid username)",
        "Checks sources in order: git config user.name, GIT_AUTHOR_NAME env, USER env, system username",
        "Falls back to 'user' if all sources fail",
        "Use for automatic branch naming without user input"
      ],
      "error_handling": "Never fails - always returns a valid username (fallback to 'user').",
      "used_by_directives": ["git_create_branch"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    },
    {
      "name": "sync_git_state",
      "file_path": "src/aifp/helpers/git/git_mutations.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "Update project.last_known_git_hash with current Git HEAD. Called after commits and during session boot.",
      "parameters": [
        {"name": "project_root", "type": "str", "required": true}
      ],
      "return_statements": [
        "Returns dict with success (bool), updated_hash (string), previous_hash (string)",
        "Updates project.last_known_git_hash field",
        "Updates project.last_git_sync timestamp",
        "Call after commits to keep hash synchronized",
        "Call during session start to establish baseline"
      ],
      "error_handling": "Logs warning if Git unavailable, continues with cached hash.",
      "used_by_directives": ["git_sync_state", "aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": ["get_current_commit_hash"]
    },
    {
      "name": "list_active_branches",
      "file_path": "src/aifp/helpers/git/git_queries.py",
      "database": "project.db",
      "target_database": "project",
      "purpose": "List all active AIFP work branches from work_branches table.",
      "parameters": [],
      "return_statements": [
        "Returns array of branch objects with branch_name, created_at, purpose, user",
        "Shows all active work branches for coordination",
        "Empty array if no branches tracked",
        "Use for multi-user collaboration visibility"
      ],
      "error_handling": "Returns empty list if work_branches table doesn't exist.",
      "used_by_directives": ["aifp_status"],
      "is_tool": false,
      "is_sub_helper": false,
      "calls_helpers": []
    }
  ]
}
