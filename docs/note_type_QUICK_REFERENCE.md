# Note Type Quick Reference for AI

**Purpose**: Guide for AI on when to use each note_type in project.db notes table

---

## Schema: 14 Valid Types

```sql
'clarification', 'pivot', 'research', 'entry_deletion',
'warning', 'error', 'info', 'auto_summary',
'decision', 'evolution', 'analysis', 'task_context',
'external', 'summary'
```

---

## When to Use Each Type

### User-Related Notes

**`clarification`** - User confirms specific intent or requirement
- "User confirmed: Use pure Python, no NumPy"
- "User clarified: Matrix operations should be immutable"
- Legacy type; consider using `decision` for new code

**`decision`** - User decisions, confirmations (broader)
- All user-confirmed choices and preferences
- Architectural decisions made by user
- Use this for new user-related notes

### Project Direction

**`pivot`** - Major direction changes affecting assumptions
- "Pivoting from CLI tool to web API"
- "Changing optimization goal: memory over speed"
- Legacy type; consider using `evolution` for new code

**`evolution`** - Project direction changes, architecture shifts (broader)
- All project evolution and architecture changes
- Infrastructure modifications
- Use this for new architecture notes

### AI Analysis

**`research`** - AI analysis, findings, refactoring reasoning
- "Function refactored for purity: eliminated mutation"
- "Analyzed codebase: 15 functions pure, 3 have side effects"
- Legacy type; consider using `analysis` for new code

**`analysis`** - AI research, findings, reasoning (broader)
- All AI-generated analysis and reasoning
- Directive decision justifications
- Use this for new AI analysis notes

### Task Management

**`task_context`** - Task/milestone/sidequest lifecycle context
- Task creation reasoning
- Milestone completion notes
- Sidequest interruption context
- Any task-related context that aids understanding

### External Events

**`external`** - Git changes, dependency updates, file system
- "External Git changes detected: 5 files modified outside AIFP"
- "Dependency added: requests==2.31.0"
- "Backup created: .aifp-project backed up to .git/.aifp/"

### Summaries

**`auto_summary`** - Automated project summaries (specific automation)
- Generated by `project_auto_summary` directive
- Periodic automatic summaries
- Keep this type for automated summaries only

**`summary`** - Manual summaries
- User-requested summaries
- AI-generated summaries on demand (not automated)
- Session summaries

### Severity Types (Consider Using severity Field Instead)

**`warning`** - Important warnings
- Use `severity='warning'` with semantic type instead
- Example: `note_type='evolution', severity='warning'`

**`error`** - Critical issues, roadblocks
- Use `severity='error'` with semantic type instead
- Example: `note_type='task_context', severity='error'`

**`info`** - Informational notes
- Use `severity='info'` with semantic type instead
- Example: `note_type='decision', severity='info'`

### Special Types

**`entry_deletion`** - Tracking entry removals
- "Function calculate_total removed from project"
- Use sparingly; most deletions tracked via git

---

## Decision Tree for Choosing Type

```
1. Is this from user?
   YES → Use 'decision' (or 'clarification' for legacy)

2. Is this project direction change?
   YES → Use 'evolution' (or 'pivot' for legacy)

3. Is this AI analysis/reasoning?
   YES → Use 'analysis' (or 'research' for legacy)

4. Is this about task/milestone/sidequest?
   YES → Use 'task_context'

5. Is this external event (git, file system, dependencies)?
   YES → Use 'external'

6. Is this automated summary?
   YES → Use 'auto_summary'

7. Is this manual summary?
   YES → Use 'summary'

8. Is this just severity indication?
   THEN → Use semantic type + severity field
           Don't use 'warning', 'error', 'info' as note_type
```

---

## Common Patterns

### User Confirmation
```sql
INSERT INTO notes (content, note_type, source, severity)
VALUES ('User confirmed: X preference', 'decision', 'user', 'info');
```

### Project Direction Change
```sql
INSERT INTO notes (content, note_type, reference_table, reference_id, source, severity)
VALUES ('Pivoting architecture to microservices', 'evolution', 'project', 1, 'ai', 'warning');
```

### AI Refactoring Reasoning
```sql
INSERT INTO notes (content, note_type, reference_table, reference_id, source, directive_name, severity)
VALUES (
    'Function refactored for purity: eliminated mutation',
    'analysis',
    'functions',
    42,
    'directive',
    'project_file_write',
    'info'
);
```

### Task Creation Context
```sql
INSERT INTO notes (content, note_type, reference_table, reference_id, source, directive_name, severity)
VALUES (
    'Subtask created for ambiguous requirement: clarify optimization target',
    'task_context',
    'tasks',
    15,
    'directive',
    'project_task_decomposition',
    'info'
);
```

### External Change Detection
```sql
INSERT INTO notes (content, note_type, source, directive_name, severity)
VALUES (
    'External changes detected: 5 files modified outside AIFP',
    'external',
    'directive',
    'git_detect_external_changes',
    'warning'
);
```

### Roadblock
```sql
-- Use task_context + severity='error' for roadblocks
INSERT INTO notes (content, note_type, reference_table, reference_id, source, severity)
VALUES (
    'Blocked: Missing dependency information from user',
    'task_context',
    'tasks',
    20,
    'ai',
    'error'  -- Severity indicates it's a blocker
);
```

---

## What NOT to Put in Notes Table

### ❌ FP Compliance Tracking
```sql
-- WRONG! This goes to user_preferences.db.fp_flow_tracking
INSERT INTO notes (content, note_type)
VALUES ('Function optimized for purity', 'optimization');
-- 'optimization' not in schema, and tracking is separate
```

**Correct**:
```sql
-- If fp_flow_tracking enabled (opt-in)
INSERT INTO fp_flow_tracking (
    function_name, file_path, fp_directives_applied, compliance_score
) VALUES ('func', 'file.py', '["fp_purity"]', 1.0);
```

### ❌ User Corrections/Learning
```sql
-- WRONG! This goes to user_preferences.db.ai_interaction_log
INSERT INTO notes (content, note_type)
VALUES ('User corrected: prefers docstrings', 'correction');
-- 'correction' not in schema, and learning is separate
```

**Correct**:
```sql
-- If ai_interaction_log enabled (opt-in)
INSERT INTO ai_interaction_log (
    interaction_type, directive_name, user_feedback, ai_interpretation
) VALUES ('correction', 'project_file_write', 'Added docstring', 'Prefers docstrings');
```

### ❌ Debug Logs
```sql
-- WRONG! Notes are for important context only
INSERT INTO notes (content, note_type)
VALUES ('Function called with args: [1, 2, 3]', 'info');
-- This is debugging, not project context
```

### ❌ Success/Failure Status
```sql
-- WRONG! Use task/milestone status fields
INSERT INTO notes (content, note_type)
VALUES ('Task completed successfully', 'success');
-- 'success' not in schema, use task status instead
```

**Correct**:
```sql
UPDATE tasks SET status = 'completed' WHERE id = 10;
```

---

## Legacy vs. New Types

AI should prefer new types for better categorization:

| Legacy Type | New Type | When to Use New |
|-------------|----------|-----------------|
| clarification | decision | All new user decisions |
| pivot | evolution | All new project changes |
| research | analysis | All new AI analysis |
| warning/error/info | (use severity field) | Always use semantic type + severity |

**Both are valid** - AI can use either, but new types provide better categorization.

---

## Examples by Directive

### project_file_write
```sql
-- Logs refactoring reasoning
INSERT INTO notes (content, note_type, reference_table, reference_id, source, directive_name)
VALUES (
    'Function X refactored for FP compliance',
    'analysis',  -- AI analysis
    'functions',
    42,
    'directive',
    'project_file_write'
);
```

### project_task_decomposition
```sql
-- Logs ambiguity that required subtask
INSERT INTO notes (content, note_type, reference_table, reference_id, source, directive_name)
VALUES (
    'Ambiguous requirement: created subtask for clarification',
    'task_context',  -- Task-related context
    'tasks',
    15,
    'directive',
    'project_task_decomposition'
);
```

### git_detect_external_changes
```sql
-- Logs external modifications
INSERT INTO notes (content, note_type, source, directive_name, severity)
VALUES (
    '5 files modified outside AIFP sessions',
    'external',  -- External event
    'directive',
    'git_detect_external_changes',
    'warning'    -- Important change
);
```

### project_auto_summary
```sql
-- Automated summary
INSERT INTO notes (content, note_type, source, directive_name)
VALUES (
    'Project: MatrixCalc | Status: 60% complete | Next: Implement transpose',
    'auto_summary',  -- Keep specific type for automation
    'directive',
    'project_auto_summary'
);
```

---

**Remember**: AI reads the CHECK constraint and categorizes appropriately. When in doubt, use broader semantic types (decision, evolution, analysis) over legacy types.
