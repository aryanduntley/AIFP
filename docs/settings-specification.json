{
  "version": "3.1",
  "created": "2026-01-04",
  "updated": "2026-01-04",
  "description": "Valid AIFP settings - only settings actually referenced in directive workflows",
  "database": "user_preferences.db",
  "location": ".aifp-project/user_preferences.db",
  "total_settings": 12,
  "philosophy": "Settings are created dynamically as users express preferences, not pre-defined speculatively",

  "user_settings": {
    "description": "Project-wide settings (user_settings table)",
    "count": 1,
    "settings": [
      {
        "key": "project_continue_on_start",
        "default": "false",
        "type": "boolean",
        "description": "Automatically continue project work on session start (if context and state available)",
        "scope": "project",
        "used_by": ["aifp_run", "Session startup logic"],
        "references": [
          "sys-prompt/aifp_system_prompt.txt:92"
        ]
      }
    ]
  },

  "directive_preferences": {
    "description": "Per-directive behavior customizations (directive_preferences table)",
    "count": 7,
    "structure": "(directive_name, preference_key, preference_value, active, description)",

    "directives": {
      "project_file_write": {
        "count": 5,
        "preferences": [
          {
            "key": "always_add_docstrings",
            "default": "false",
            "type": "boolean",
            "description": "Automatically add docstrings to all functions",
            "references": [
              "docs/directives-json/directives-project.json:609",
              "src/aifp/reference/directives/project_file_write.md",
              "src/aifp/reference/directives/user_preferences_sync.md"
            ]
          },
          {
            "key": "max_function_length",
            "default": null,
            "type": "integer",
            "description": "Maximum allowed lines per function (warns if exceeded)",
            "example": "50",
            "references": [
              "src/aifp/reference/directives/project_file_write.md",
              "src/aifp/reference/directives/user_preferences_sync.md"
            ]
          },
          {
            "key": "prefer_guard_clauses",
            "default": "false",
            "type": "boolean",
            "description": "Use guard clauses (early returns) instead of nested if statements",
            "references": [
              "src/aifp/reference/directives/project_file_write.md",
              "src/aifp/reference/directives/user_preferences_sync.md"
            ]
          },
          {
            "key": "code_style",
            "default": null,
            "type": "enum",
            "values": ["compact", "verbose", "explicit"],
            "description": "Overall coding style preference",
            "references": [
              "src/aifp/reference/directives/project_file_write.md",
              "src/aifp/reference/directives/user_preferences_sync.md"
            ]
          },
          {
            "key": "indent_style",
            "default": null,
            "type": "enum",
            "values": ["spaces_2", "spaces_4", "tabs"],
            "description": "Indentation style for generated code",
            "references": [
              "src/aifp/reference/directives/project_file_write.md",
              "src/aifp/reference/directives/user_preferences_sync.md"
            ]
          }
        ]
      },

      "project_task_decomposition": {
        "count": 3,
        "preferences": [
          {
            "key": "naming_convention",
            "default": "descriptive",
            "type": "enum",
            "values": ["descriptive", "short", "numbered"],
            "description": "How to name tasks and subtasks",
            "references": [
              "src/aifp/reference/directives/project_task_decomposition.md"
            ]
          },
          {
            "key": "auto_create_items",
            "default": "true",
            "type": "boolean",
            "description": "Automatically create items for tasks during decomposition",
            "references": [
              "src/aifp/reference/directives/project_task_decomposition.md"
            ]
          },
          {
            "key": "default_priority",
            "default": "medium",
            "type": "enum",
            "values": ["low", "medium", "high", "critical"],
            "description": "Default priority level for new tasks (matches schema priority)",
            "references": [
              "src/aifp/reference/directives/project_task_decomposition.md"
            ]
          }
        ]
      }
    }
  },

  "tracking_settings": {
    "description": "Feature flags for opt-in tracking/logging (tracking_settings table) - all disabled by default",
    "count": 5,
    "privacy_note": "Users should be warned about token overhead before enabling any tracking feature",
    "cost_philosophy": "All tracking disabled by default to minimize API costs",

    "features": [
      {
        "name": "fp_flow_tracking",
        "enabled": false,
        "description": "Track which FP directives AI consults during code writing",
        "token_overhead": "~5% per file write",
        "purpose": "Analytics on FP pattern usage over time",
        "used_by": ["FP analysis tools"],
        "references": [
          "docs/directives-json/directives-user-pref.json",
          "docs/directives-json/directive_flow_user_preferences.json",
          "src/aifp/reference/directives/user_preferences_sync.md",
          "src/aifp/reference/directives/tracking_toggle.md"
        ]
      },
      {
        "name": "ai_interaction_log",
        "enabled": false,
        "description": "Log all user corrections and feedback for preference learning",
        "token_overhead": "~3% overall",
        "purpose": "Enable AI to learn from user corrections",
        "required_for": ["user_preferences_learn"],
        "used_by": ["user_preferences_learn directive"],
        "references": [
          "docs/directives-json/directives-user-pref.json",
          "src/aifp/reference/directives/tracking_toggle.md",
          "src/aifp/reference/directives/user_preferences_sync.md"
        ]
      },
      {
        "name": "helper_function_logging",
        "enabled": false,
        "description": "Log directive execution outcomes and helper function errors",
        "token_overhead": "~1% on errors",
        "purpose": "Performance tracking and debugging",
        "used_by": ["project_performance_summary (if implemented)"],
        "references": [
          "docs/directives-json/directives-user-pref.json",
          "src/aifp/reference/directives/tracking_toggle.md"
        ]
      },
      {
        "name": "issue_reports",
        "enabled": false,
        "description": "Enable detailed bug report compilation",
        "token_overhead": "~2% on errors",
        "purpose": "Error tracking and issue reporting",
        "used_by": ["Error reporting system (if implemented)"],
        "references": [
          "docs/directives-json/directives-user-pref.json",
          "src/aifp/reference/directives/tracking_toggle.md"
        ]
      },
      {
        "name": "compliance_checking",
        "enabled": false,
        "description": "Track FP compliance patterns and generate compliance analytics",
        "token_overhead": "~5-10% per check",
        "purpose": "Optional analytics for FP compliance patterns (NOT validation)",
        "used_by": ["project_compliance_check directive"],
        "use_cases": [
          "AIFP development/debugging",
          "Project audits requiring compliance documentation",
          "Research on FP pattern adoption",
          "Educational tracking"
        ],
        "note": "FP compliance is BASELINE behavior. This tracks patterns, not validates code.",
        "references": [
          "src/aifp/reference/directives/project_compliance_check.md",
          "docs/settings-cleanup-summary.md",
          "docs/project_compliance_check_cleanup_plan.md"
        ]
      }
    ]
  },

  "integration": {
    "description": "How settings are loaded and applied",
    "loading_workflow": [
      "1. AI receives user request",
      "2. AI determines which directive to execute",
      "3. BEFORE executing directive: Check if directive has preferences",
      "4. IF preferences exist: Call user_preferences_sync(directive_name)",
      "5. user_preferences_sync queries: SELECT preference_key, preference_value FROM directive_preferences WHERE directive_name=? AND active=1",
      "6. Apply preferences to directive execution context",
      "7. Execute directive with modified behavior",
      "8. Return result"
    ],
    "key_directives": {
      "user_preferences_sync": "Loads preferences before directive execution",
      "user_preferences_update": "Creates/updates preferences dynamically",
      "user_preferences_learn": "Infers preferences from user corrections (requires ai_interaction_log enabled)",
      "tracking_toggle": "Enables/disables tracking features"
    }
  },

  "dynamic_creation": {
    "description": "Settings are created on-demand, not pre-defined",
    "workflow": [
      "1. User expresses preference during interaction",
      "2. AI calls user_preferences_update",
      "3. AI identifies target directive and creates preference",
      "4. AI updates directive workflow to check setting (if needed)",
      "5. AI confirms to user",
      "6. Setting is documented"
    ],
    "example": "User: 'Always add type hints' â†’ AI creates project_file_write.always_add_type_hints = true",
    "guidelines": {
      "do_create_when": [
        "User expresses a preference",
        "Setting modifies existing directive behavior",
        "Preference is reusable across sessions",
        "Setting provides value (not micro-management)"
      ],
      "dont_create_when": [
        "Trying to override locked database schema values",
        "Preference is one-time only",
        "Directive doesn't check for the setting",
        "Setting is too granular (micro-optimization)"
      ]
    }
  },

  "validation": {
    "boolean_settings": "Valid values: 'true', 'false', '1', '0'",
    "enum_settings": "Must match one of the specified values",
    "integer_settings": "Must be positive integers within specified ranges",
    "float_settings": "Range 0.0-1.0 for confidence/threshold values",
    "json_settings": "Must be valid JSON strings"
  },

  "changelog": {
    "3.1": {
      "date": "2026-01-04",
      "changes": [
        "Removed 5 FP compliance settings (FP now baseline in system prompt, not checked after writes)",
        "Removed: fp_strictness_level, prefer_explicit_returns, suppress_warnings (global)",
        "Removed: project_compliance_check directive preferences (all 3 settings)",
        "Removed: task_granularity (schema has fixed priority, cannot modify)",
        "Adjusted: default_priority to use schema strings (low/medium/high/critical) not integers",
        "Added: project_continue_on_start (autostart setting from system prompt)",
        "Total reduced from 18 to 12 settings (1 global, 7 directive prefs, 4 tracking)"
      ]
    },
    "3.0": {
      "date": "2026-01-04",
      "changes": [
        "Complete rewrite based on directive analysis",
        "Removed 74+ unused/invalid settings",
        "Kept only 18 settings actually referenced in directives",
        "Added references to directive files for each setting",
        "Documented dynamic creation workflow",
        "Added integration guidance"
      ]
    },
    "2.0": {
      "date": "2025-12-18",
      "changes": ["Previous spec with 92+ settings (mostly unused)"]
    }
  },

  "notes": [
    "This specification reflects ONLY settings that are actually used in directive workflows",
    "Settings can be added dynamically when users express preferences",
    "All new settings should be integrated into directive workflows before being documented",
    "Tracking features are opt-in only to minimize API token costs",
    "FP compliance is now baseline behavior in system prompt (not checked via directives)",
    "project_compliance_check has been repurposed as optional tracking directive (NOT validation, NOT FP directive)"
  ]
}
